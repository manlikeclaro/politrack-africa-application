{% extends 'main_application/base.html' %}
{% load static %}

{% block title %}
    Contact
{% endblock %}

{% block content %}
    <main id="main">

        <!-- ======= Breadcrumbs ======= -->
        <section class="breadcrumbs">
            <div class="container">

                <div class="d-flex justify-content-between align-items-center">
                    <ol>
                        <li></li>
                    </ol>
                </div>

            </div>
        </section><!-- End Breadcrumbs -->

        <!-- ======= Contact Section ======= -->
        <section id="contact" class="contact">
            <div class="container" data-aos="fade-up">

                <div class="section-title">
                    <h2 class="text-black">Our Location</h2>
                </div>

                <div class="mb-5">
                    <div class="embed-responsive embed-responsive-16by9">
                        <iframe class="embed-responsive-item" style="width: 100%; height: 300px"
                                src="https://www.google.com/maps/embed?pb=!1m14!1m8!1m3!1d15955.20547406484!2d36.797083!3d-1.293661!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x182f10bc34bbcd01%3A0x60b7e4bbd306cd50!2sSilverpool%20Office%20Suites!5e0!3m2!1sen!2sus!4v1713448140309!5m2!1sen!2sus"
                                allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                    </div>
                </div>


                <div class="section-title">
                    <h2 class="text-black">Contact Us</h2>
                </div>

                <div class="row 5">
                    <div class="">
                        <form id="contactForm" method="post" role="form"
                              class="php-email-form p-4 rounded bg-light border"
                              style="color: #333333;">
                            {% csrf_token %}
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    {{ form.name }}
                                </div>
                                <div class="col-md-6 mb-3">
                                    {{ form.email }}
                                </div>
                            </div>
                            <div class="mb-3">
                                {{ form.subject }}
                            </div>
                            <div class="mb-3">
                                {{ form.message }}
                            </div>
                            <div class="my-3 d-flex justify-content-center">
                                <div class="col-sm-8">
                                    <div id="loading" class="loading text-center">Processing</div>
                                    <div id="errorMessage" style="display: none;"
                                         class="form-outline alert alert-danger alert-dismissible fade show"
                                         role="alert">
                                        Error message here
                                        <button type="button" class="btn-close" data-bs-dismiss="alert"
                                                aria-label="Close"></button>
                                    </div>
                                    <div id="successMessage" style="display: none;"
                                         class="form-outline alert alert-success alert-dismissible fade show"
                                         role="alert">
                                        Success message here
                                        <button type="button" class="btn-close" data-bs-dismiss="alert"
                                                aria-label="Close"></button>
                                    </div>
                                </div>
                            </div>
                            <div class="text-center">
                                <button type="submit" class="btn btn-primary">Submit Enquiry</button>
                            </div>
                        </form>


                        <script>
                            document.addEventListener('DOMContentLoaded', function () {
                                var contactForm = document.getElementById('contactForm');
                                var successMessage = document.getElementById('successMessage');
                                var errorMessage = document.getElementById('errorMessage');
                                var loading = document.getElementById('loading');

                                contactForm.addEventListener('submit', function (e) {
                                    e.preventDefault();

                                    var formData = new FormData(contactForm);
                                    var xhr = new XMLHttpRequest();
                                    xhr.open('POST', contactForm.action);
                                    xhr.setRequestHeader('X-CSRFToken', '{{ csrf_token }}');
                                    xhr.responseType = 'json';

                                    xhr.onload = function () {
                                        var response = xhr.response;
                                        if (xhr.status >= 200 && xhr.status < 300) {
                                            successMessage.innerText = response.message;
                                            successMessage.style.display = 'block';
                                            errorMessage.style.display = 'none';
                                            contactForm.reset();
                                        } else {
                                            errorMessage.innerText = response.errors || 'An error occurred while submitting the form.';
                                            errorMessage.style.display = 'block';
                                            successMessage.style.display = 'none';
                                        }
                                        loading.style.display = 'none';
                                    };

                                    xhr.onerror = function () {
                                        errorMessage.innerText = 'An error occurred while processing your request.';
                                        errorMessage.style.display = 'block';
                                        successMessage.style.display = 'none';
                                        loading.style.display = 'none';
                                    };

                                    loading.style.display = 'block';
                                    xhr.send(formData);
                                });
                            });
                        </script>


                    </div>
                </div>

            </div>
        </section><!-- End Contact Section -->

    </main><!-- End #main -->
{% endblock %}

